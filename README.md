# Concourse-Common  
Common util methods for concourse resources in python

## Installing
````
pip install git+https://github.com/cosee-concourse/concourse-common.git
````
Note that pip install without a specified version installs the latest tagged version (see [Concourse-Common Tags](https://github.com/cosee-concourse/concourse-common/tags))

To install with a specific version:
````
pip install git+https://github.com/cosee-concourse/concourse-common.git@v0.1.0
````

Adding to the requirements.txt as:
````
git+https://github.com/cosee-concourse/concourse-common.git
````

## Methods

#### common: methods necessary for every concourse resource

`load_payload`: Loads concourse json input from stdin, logs it in a temporary folder and returns it as json

`validate_payload(payload, schema)`: Validates the json payload given a json schema (e.g. generated by [JSON Schema](http://jsonschema.net))
Prints validation errors to stderr
 
`log(*args, **kwargs)`: Prints to stderr to create log output in concourse
 
The other log methods create colored log output using ANSI Escape codes. 
Defaults back to red after the warning oder info log messages so that pythons exceptions are printed in red 
 
`log_error`: Red output.
 
`log_warning`: Yellow output.
 
`log_info`: White output.
 
 
#### testutil: utility methods for testing resources

`mock_stderr`: Mocks stderr with a StringIO object and returns it. 
This object can then be used with `read_from_io(StringIO)` to read all lines from stderr.

`mock_stdout`: Same as `mock_stderr` but mocks stdout.

`read_from_io(io)`: Reads all lines from a StringIO object from the beginning and strips the new line character from it.

`put_stdin(content)`: Mocks stdin with a StringIO object and writes string content to the object.

`validate_filepath(filepath)`: Validates that file at filepath exists

## Contributing
To create a new version of this package you need to create a new tag with a higher version than the latest tagged version.

For example with git:
````
git tag -a v0.1.0 -m 'version 0.1.0 initial version'
git push --tags   
````

or create a new tag on GitHub

Note: also bump the version in setup.py before tagging